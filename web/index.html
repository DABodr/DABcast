<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DAB WebUI</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="top">
    <div class="brand">
      <div class="logo">DAB</div>
      <div>
        <div class="title" id="muxName">Mux</div>
        <div class="subtitle" id="muxSubtitle">Demo preset</div>
      </div>
    </div>

    <div class="actions">
      <button id="btnMux" class="btn">Multiplex</button>
      <button id="btnLogs" class="btn">Logs</button>
      <button id="btnStop" class="btn btn-danger">Stop</button>
      <button id="btnStart" class="btn btn-success">Start</button>
      <div class="onair" id="onAir">OFF AIR</div>
    </div>
  </header>

  <main class="main">
    <div class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Services</div>
          <div class="card-hint">Ajouter / modifier via la fenêtre. Certains champs sont verrouillés quand c'est ON AIR.</div>
          <div class="card-hint" id="capHint"></div>
        </div>
        <div class="row">
          <button id="btnExportAll" class="btn btn-mini">Exporter config</button>
          <button id="btnImportAll" class="btn btn-mini">Importer config</button>
          <button id="btnExportService" class="btn btn-mini">Exporter service</button>
          <button id="btnImportService" class="btn btn-mini">Importer service</button>
          <button id="btnAdd" class="btn">+ Add service</button>
        </div>
      </div>

      <div class="tablewrap">
        <table class="table table-wide" id="svcTable">
          <thead>
            <tr>
              <th>Status</th>
              <th>PS8</th>
              <th>Main</th>
              <th>Bkp</th>
              <th>Bitrate</th>
              <th>CU</th>
              <th>Prot</th>
              <th>Codec</th>
              <th>Channels</th>
              <th>Sample</th>
              <th>Port</th>
              <th>Stream</th>
              <th>Backup</th>
              <th>DLS</th>
              <th>SLS</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>

  <input type="file" id="fileImportAll" accept="application/json" hidden />
  <input type="file" id="fileImportService" accept="application/json" hidden />

  <dialog id="dlgService" class="modal">
    <form method="dialog" class="modal-body modal-service" id="svcForm">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="dlgTitle">Service</div>
          <div class="modal-sub" id="dlgLockHint"></div>
        </div>
        <button class="icon" value="cancel" aria-label="Fermer">✕</button>
      </div>
      <div class="alert hidden" id="svcError"></div>

      <div class="tabs" role="tablist" aria-label="Service tabs">
        <button type="button" class="tab active" data-tab="general">General</button>
        <button type="button" class="tab" data-tab="audio">Audio source</button>
        <button type="button" class="tab" data-tab="metadata">Metadata source</button>
        <button type="button" class="tab" data-tab="triggers">External triggers</button>
      </div>

      <section class="tabpanel" data-panel="general">
        <div class="grid3">
          <label>
            <span>PI</span>
            <input id="f_pi" maxlength="4" placeholder="F204" />
          </label>
          <label>
            <span>PS8</span>
            <input id="f_ps8" maxlength="8" required />
          </label>
          <label>
            <span>PS16</span>
            <input id="f_ps16" maxlength="16" />
          </label>

          <label>
            <span>Language</span>
            <input id="f_lang" placeholder="0x0F" />
          </label>
          <label>
            <span>PTY</span>
            <input id="f_pty" type="number" min="0" max="31" />
          </label>
          <label>
            <span>Protection</span>
            <select id="f_prot">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
            </select>
          </label>

          <label>
            <span>Bitrate (kbps)</span>
            <select id="f_bitrate"></select>
          </label>
          <label>
            <span>Sample rate</span>
            <select id="f_sr">
              <option value="48000">48 kHz</option>
            </select>
          </label>
          <label>
            <span>Channels</span>
            <select id="f_ch">
              <option value="2">Stereo</option>
              <option value="1">Mono</option>
            </select>
          </label>

          <label>
            <span>CU (estim.)</span>
            <input id="f_cu" disabled />
          </label>
          <label>
            <span>Codec</span>
            <select id="f_codec">
              <option value="HE-AAC v1 (SBR)">HE-AAC v1 (SBR)</option>
              <option value="HE-AAC v2 (PS)">HE-AAC v2 (PS)</option>
              <option value="AAC-LC">AAC-LC</option>
            </select>
          </label>

          <label>
            <span>ZMQ buffer</span>
            <input id="f_zbuf" type="number" min="0" max="4000" />
          </label>
          <label>
            <span>ZMQ prebuffer</span>
            <input id="f_zpre" type="number" min="0" max="4000" />
          </label>
          <label>
            <span>Encoder buffer (ms)</span>
            <input id="f_encbuf" type="number" min="0" max="2000" />
          </label>
        </div>
      </section>

      <section class="tabpanel hidden" data-panel="audio">
        <div class="grid2">
          <label>
            <span>Main audio source</span>
            <select id="f_src">
              <option value="VLC">VLC</option>
              <option value="GSTREAMER">GStreamer</option>
            </select>
          </label>
          <label>
            <span>Audio gain (dB)</span>
            <input id="f_gain" type="number" step="0.5" min="-20" max="20" />
          </label>

          <label class="span2">
            <span>Main stream</span>
            <input id="f_uri" placeholder="http://..." />
          </label>

          <label>
            <span>Watchdog</span>
            <select id="f_wd">
              <option value="1">ON</option>
              <option value="0">OFF</option>
            </select>
          </label>
          <label>
            <span>Silence (sec)</span>
            <input id="f_thresh" type="number" min="1" max="600" />
          </label>
          <label>
            <span>Warn (sec)</span>
            <input id="f_warn" type="number" min="1" max="600" />
          </label>
          <label>
            <span>Return main (sec)</span>
            <input id="f_return" type="number" min="0" max="3600" />
          </label>
          <label>
            <span>Switch to backup</span>
            <select id="f_switch">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </label>

          <label class="span2">
            <span>Backup stream</span>
            <input id="f_backup" placeholder="http://..." />
          </label>

          <div class="row span2">
            <button type="button" class="btn" id="btnSwap">Swap main/backup</button>
          </div>
        </div>
      </section>

      <section class="tabpanel hidden" data-panel="metadata">
        <div class="grid2">
          <label>
            <span>Metadata mode</span>
            <select id="f_meta_mode">
              <option value="NONE">None</option>
              <option value="JSON">JSON (HTTP)</option>
              <option value="XML">XML (HTTP)</option>
              <option value="STREAM">Stream (ICY)</option>
              <option value="FILE">Local file</option>
            </select>
          </label>
          <label>
            <span>Download interval (sec)</span>
            <input id="f_meta_interval" type="number" min="1" max="600" />
          </label>

          <label class="span2">
            <span>URL / Path</span>
            <input id="f_meta_url" placeholder="http://... or /path/file.txt" />
          </label>
          <div class="row">
            <button type="button" class="btn" id="btnTestDls">Test DLS</button>
            <span class="muted" id="dlsTestStatus"></span>
          </div>

          <label>
            <span>Artist key</span>
            <input id="f_meta_artist" placeholder="artist" />
          </label>
          <label>
            <span>Title key</span>
            <input id="f_meta_title" placeholder="title" />
          </label>

          <label>
            <span>SLS key</span>
            <input id="f_meta_sls" placeholder="cover" />
          </label>
          <label>
            <span>Fallback DLS</span>
            <input id="f_default_dls" placeholder="OpenDigitalRadio" />
          </label>

          <label>
            <span>SLS image URL</span>
            <input id="f_sls_url" placeholder="https://.../cover.jpg" />
          </label>
          <div class="row">
            <button type="button" class="btn" id="btnTestSls">Test SLS</button>
            <span class="muted" id="slsTestStatus"></span>
          </div>

          <label>
            <span>SLS back color</span>
            <input id="f_sls_back" placeholder="#000000" />
          </label>
          <label>
            <span>SLS font color</span>
            <input id="f_sls_font" placeholder="#FFFFFF" />
          </label>

          <label>
            <span>Default DLS allowed</span>
            <select id="f_dls_allowed">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </label>
          <label>
            <span>Default SLS allowed</span>
            <select id="f_sls_allowed">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </label>
          <label>
            <span>Include DLS in SLS</span>
            <select id="f_dls_included">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </label>

          <div class="span2 slsbox">
            <div class="sls-title">SLS (logo)</div>
            <div class="slsrow">
              <img id="slsImg" alt="SLS" />
              <div class="slsctl">
                <input id="f_logo" type="file" accept="image/*" />
                <div class="row">
                  <button type="button" class="btn" id="btnUploadLogo">Upload</button>
                  <button type="button" class="btn" id="btnClearLogo">Clear</button>
                </div>
                <div class="muted" id="slsHint"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="tabpanel hidden" data-panel="triggers">
        <div class="empty">
          <div class="muted">(Soon) External triggers like DabPlatform: GPIO, HTTP hooks, scheduler…</div>
        </div>
      </section>

      <div class="modal-actions">
        <div class="left">
          <button type="button" class="btn" id="btnPrev">◀ Prev</button>
          <button type="button" class="btn" id="btnNext">Next ▶</button>
        </div>
        <div class="right">
          <button type="button" class="btn" data-action="svc-cancel">Cancel</button>
          <button id="btnSave" value="default" class="btn btn-success">OK</button>
        </div>
      </div>
    </form>
  </dialog>

  <dialog id="dlgLogs" class="modal">
    <form method="dialog" class="modal-body modal-logs">
      <div class="modal-head">
        <div>
          <div class="modal-title">Logs</div>
          <div class="modal-sub">Historique cumulé</div>
        </div>
        <button class="icon" value="cancel" aria-label="Fermer">✕</button>
      </div>
      <div class="tabs logs-tabs" role="tablist" aria-label="Logs tabs">
        <button type="button" class="tab active" data-logtab="all">Tous</button>
        <button type="button" class="tab" data-logtab="dabmux">odr-dabmux</button>
        <button type="button" class="tab" data-logtab="audio">odr-audioenc / odr-padenc</button>
        <button type="button" class="tab" data-logtab="proc">Processus lancés</button>
        <button type="button" class="tab" data-logtab="errors">Erreurs</button>
      </div>
      <pre id="logsPre" class="logs"></pre>
      <div class="modal-actions">
        <button value="cancel" class="btn">Close</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgMux" class="modal">
    <form method="dialog" class="modal-body" id="muxForm">
      <div class="modal-head">
        <div>
          <div class="modal-title">Multiplex</div>
          <div class="modal-sub">Paramètres ensemble/sortie (comme DabCast)</div>
        </div>
        <button class="icon" value="cancel" aria-label="Fermer">✕</button>
      </div>

      <div class="grid">
        <label>
          <span>Ensemble ID (hex)</span>
          <input id="m_ens_id" placeholder="0xF408" />
        </label>
        <label>
          <span>ECC (hex)</span>
          <input id="m_ecc" placeholder="0xE1" />
        </label>
        <label>
          <span>Label (PS16)</span>
          <input id="m_label" maxlength="16" />
        </label>
        <label>
          <span>Shortlabel (PS8)</span>
          <input id="m_short" maxlength="8" />
        </label>
        <label>
          <span>TX mode</span>
          <select id="m_txmode">
            <option value="EASYDAB">EASYDAB (ZMQ out)</option>
            <option value="EDI">EDI (TCP out)</option>
            <option value="USRP1">USRP1 (stdout ETI)</option>
          </select>
        </label>
        <label>
          <span>EasyDAB IP</span>
          <input id="m_easydab_ip" placeholder="0.0.0.0" />
        </label>
        <label>
          <span>EasyDAB Port</span>
          <input id="m_easydab_port" type="number" min="1024" max="65535" />
        </label>
        <label>
          <span>EDI listen port</span>
          <input id="m_edi_port" type="number" min="1024" max="65535" />
        </label>
        <label>
          <span>Management port</span>
          <input id="m_mgmt" type="number" min="1024" max="65535" />
        </label>
        <label>
          <span>Telnet port</span>
          <input id="m_telnet" type="number" min="1024" max="65535" />
        </label>
      </div>

      <div class="modal-foot">
        <div class="muted" id="muxLockHint"></div>
        <div class="spacer"></div>
        <button type="button" class="btn" data-action="mux-cancel">Cancel</button>
        <button class="btn btn-success" id="btnMuxSave" value="default">Save</button>
      </div>
    </form>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
